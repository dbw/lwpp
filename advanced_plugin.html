<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LightWrap++: A more complex, complete plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LightWrap++
   </div>
   <div id="projectbrief">AC++wrapperfortheLightWave3DSDK</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('advanced_plugin.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">A more complex, complete plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the source code for a complete shading node.</p>
<dl class="section note"><dt>Note:</dt><dd>This document covers LightWrap++ and not the LightWave SDK. A fairly thorough understanding of the LightWave SDK is required to understand the details of this sample. While lwpp wraps the LightWave 3D SDK it does not replace many of the concepts, it only expands upon them.</dd></dl>
 First you need to include the appropriate headers: <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="node__handler_8h.html">lwpp/node_handler.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="vparm_8h.html" title="C++ Wrapper implementation for LightWave VParms.">lwpp/vparm.h</a>&gt;</span></div>
</div><!-- fragment --> </p>
<h1><a class="anchor" id="Class"></a>
Plugin class definition</h1>
<p>The next step is to actually define the class.</p>
<p>Since this will be a Node with an XPanel GUI, it will be derived from <a class="el" href="classlwpp_1_1_x_panel_node_handler.html">lwpp::XPanelNodeHandler</a>.</p>
<p>You only need to actually define and implement the member functions you need. However, the constructor is essential. </p>
<dl class="section note"><dt>Note:</dt><dd>Don't worry about the MaterialComponent, this will be covered later</dd></dl>
<p><div class="fragment"><div class="line"><span class="keyword">class </span>MaterialMixer : <span class="keyword">public</span> <a class="code" href="classlwpp_1_1_x_panel_node_handler.html">lwpp::XPanelNodeHandler</a></div>
<div class="line">{</div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <a class="code" href="classlwpp_1_1_l_w_node_utility.html">lwpp::LWNodeUtility</a> nodeUtil;</div>
<div class="line">    <a class="code" href="classlwpp_1_1_l_w_node_output.html">lwpp::LWNodeOutput</a> *outMaterial;</div>
<div class="line">    <a class="code" href="classlwpp_1_1_l_w_node_output.html">lwpp::LWNodeOutput</a> *outDiffuse, *outSpecular, *outReflection, *outRefraction, *outTransparency;</div>
<div class="line">    <a class="code" href="classlwpp_1_1_l_w_node_input.html" title="Node Input.">lwpp::LWNodeInput</a> *inBaseMaterial, *inTopMaterial;</div>
<div class="line">    <a class="code" href="classlwpp_1_1_l_w_node_input.html" title="Node Input.">lwpp::LWNodeInput</a> *inBaseDiffuse, *inBaseSpecular, *inBaseReflection, *inBaseRefraction, *inBaseTransparency;</div>
<div class="line">    <a class="code" href="classlwpp_1_1_l_w_node_input.html" title="Node Input.">lwpp::LWNodeInput</a> *inTopDiffuse, *inTopSpecular, *inTopReflection, *inTopRefraction, *inTopTransparency;</div>
<div class="line">    MaterialComponent Diffuse, Specular, Reflection, Refraction, Transparency;</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">  MaterialMixer (<span class="keywordtype">void</span> *priv, <span class="keywordtype">void</span> *context, LWError *err);</div>
<div class="line">  ~MaterialMixer ();</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span>  <a class="code" href="classlwpp_1_1_node_handler.html#ad8173b2e58fec04fb7650763e8eb4d48">Evaluate</a> (<a class="code" href="namespace_light_wave95.html#a5d7398223d10608d7239c03a96ddaac0">LWNodalAccess</a> *na, NodeOutputID outID, NodeValue value);</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">int</span>   <a class="code" href="classlwpp_1_1_x_panel_interface.html#a30270b56c812a1a3b12a5e70eab2213e">Interface</a> (<span class="keywordtype">int</span> version, LWInterface *local, <span class="keywordtype">void</span> *serverdata);</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> *<a class="code" href="classlwpp_1_1_x_panel_interface.html#af1a99e652b66ebc82619e8cfc5039c7f" title="Put data into a XPanel View.">DataGet</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vid);</div>
<div class="line">  <span class="keyword">virtual</span> LWXPRefreshCode <a class="code" href="classlwpp_1_1_x_panel_interface.html#a3367d544fda0defa57d36ffe33aedff3" title="Retrieve data fom a XPanel View.">DataSet</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vid, <span class="keywordtype">void</span> *value);</div>
<div class="line">  <span class="keyword">virtual</span> MaterialMixer &amp;operator=(<span class="keyword">const</span> MaterialMixer &amp;from);</div>
<div class="line">  <span class="keyword">virtual</span> LWError <a class="code" href="classlwpp_1_1_render_handler.html#a9e93b5a2d01ce9b917d956eba4b8aec0">NewTime</a> (LWFrame frame, LWTime time);</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span>  <a class="code" href="classlwpp_1_1_x_panel_node_handler.html#a7a9dbd139fcd475b917928cd8da133d4">ChangeNotify</a> (LWXPanelID panel, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cid, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vid, <span class="keywordtype">int</span> event_type);</div>
<div class="line">  <span class="keyword">virtual</span> LWError <a class="code" href="classlwpp_1_1_storeable.html#a0580c9da89100c44170c447f00f8a251" title="Load data from a LWLoadState.">Load</a> (<span class="keyword">const</span> <a class="code" href="classlwpp_1_1_load_state.html" title="Wrapper for a LW save state.">lwpp::LoadState</a> &amp;ls);</div>
<div class="line">  <span class="keyword">virtual</span> LWError <a class="code" href="classlwpp_1_1_storeable.html#a94013c12ec3483db0ef74b1b7a5de0b2" title="Save data to a LWSaveState.">Save</a> (<span class="keyword">const</span> <a class="code" href="classlwpp_1_1_save_state.html" title="Wrapper for a LW save state.">lwpp::SaveState</a> &amp;ss);</div>
<div class="line">};</div>
</div><!-- fragment --> </p>
<h1><a class="anchor" id="Register"></a>
Registering the plugin</h1>
<p>The next step is to register the plugin with lwpp. This will allow lwpp to create the plugin once the plugin file is loaded into LightWave. (For seasoned developers: This completely replaces the need to create a ServerDesc or _mod_descrip). <div class="fragment"><div class="line">ServerTagInfo <a class="code" href="_material_blender_8cpp.html#ab4c2df878d3742cc9ebcfbe46174f12a">tags</a>[] =</div>
<div class="line">{</div>
<div class="line">  {<span class="stringliteral">&quot;Material Blender&quot;</span>,SRVTAG_USERNAME},</div>
<div class="line">  {<span class="stringliteral">&quot;db&amp;w/Materials&quot;</span>,SRVTAG_NODEGROUP},</div>
<div class="line">  { <a class="code" href="global_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> }</div>
<div class="line">};</div>
<div class="line"><a class="code" href="classlwpp_1_1_x_panel_node_adaptor.html">lwpp::XPanelNodeAdaptor&lt;MaterialMixer&gt;</a> <a class="code" href="_material_blender_8cpp.html#a108f0780f08deb8a3fe0dae8da14342d">mixerInstance</a>(<a class="code" href="_material_blender_8cpp.html#aa407a87106856e695db211c63ff71fe6">pluginName</a>, <a class="code" href="_material_blender_8cpp.html#ab4c2df878d3742cc9ebcfbe46174f12a">tags</a>);</div>
</div><!-- fragment --> </p>
<h1><a class="anchor" id="basic"></a>
Initializing the plugin, basic member functions</h1>
<p>Let's have a look at the constructor of the plugin. <div class="fragment"><div class="line">MaterialMixer::MaterialMixer (<span class="keywordtype">void</span> *priv, <span class="keywordtype">void</span> *context, LWError *err)</div>
<div class="line">    : lwpp::XPanelNodeHandler(priv, context, err)</div>
<div class="line">{</div>
</div><!-- fragment --> You need to initilize the base classe <a class="el" href="classlwpp_1_1_x_panel_node_handler.html">lwpp::XPanelNodeHandler</a> with the parameters to your plugin. These are the same for most kinds of plugins.</p>
<p>The following lines check the version of LW and will return an error message if LightWave is of a version earlier than 9.2 (since this is when Materials got introduced). The error message will be returned to LightWave and displayed, initializing the plugin will fail and the destructor will be called. <div class="fragment"><div class="line">  <span class="keywordflow">if</span> ( (<a class="code" href="classlwpp_1_1_light_wave.html#af074dc0c76e33f10f5079202cd338712" title="Get the major version of LightWave.">lwpp::LightWave::Major</a>() &lt; 9) ||</div>
<div class="line">       ( (<a class="code" href="classlwpp_1_1_light_wave.html#af074dc0c76e33f10f5079202cd338712" title="Get the major version of LightWave.">lwpp::LightWave::Major</a>() == 9) &amp;&amp; (<a class="code" href="classlwpp_1_1_light_wave.html#ae9883f86b1bc58de9dc9f11cdca06407" title="Get the minor version of LightWave.">lwpp::LightWave::Minor</a>() &lt; 2) ) )</div>
<div class="line">  {</div>
<div class="line">    *err = <span class="stringliteral">&quot;This plugin needs a newer version of LightWave 3D (9.2 as a minimum)&quot;</span>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
</div><!-- fragment --> This is how inputs are added to the node. The variables are member variables. <div class="fragment"><div class="line"></div>
<div class="line">  inBaseMaterial =  addMaterialInput(<span class="stringliteral">&quot;Fg Material&quot;</span>);</div>
<div class="line">  inBaseDiffuse = addColourInput(<span class="stringliteral">&quot;Fg Diffuse&quot;</span>);</div>
<div class="line">  inBaseSpecular =  addColourInput(<span class="stringliteral">&quot;Fg Specular&quot;</span>);</div>
<div class="line">  inBaseReflection =  addColourInput(<span class="stringliteral">&quot;Fg Reflection&quot;</span>);</div>
<div class="line">  inBaseRefraction =  addColourInput(<span class="stringliteral">&quot;Fg Refraction&quot;</span>);</div>
<div class="line">  inBaseTransparency =  addScalarInput(<span class="stringliteral">&quot;Fg Transparency&quot;</span>);</div>
<div class="line"></div>
<div class="line">  inTopMaterial = addMaterialInput(<span class="stringliteral">&quot;Bg Material&quot;</span>);</div>
<div class="line">  inTopDiffuse =  addColourInput(<span class="stringliteral">&quot;Bg Diffuse&quot;</span>);</div>
<div class="line">  inTopSpecular = addColourInput(<span class="stringliteral">&quot;Bg Specular&quot;</span>);</div>
<div class="line">  inTopReflection = addColourInput(<span class="stringliteral">&quot;Bg Reflection&quot;</span>);</div>
<div class="line">  inTopRefraction = addColourInput(<span class="stringliteral">&quot;Bg Refraction&quot;</span>);</div>
<div class="line">  inTopTransparency = addScalarInput(<span class="stringliteral">&quot;Bg Transparency&quot;</span>);</div>
</div><!-- fragment --> Attaching outputs to the node is quite similar. <div class="fragment"><div class="line"></div>
<div class="line">  outMaterial = addMaterialOutput(<span class="stringliteral">&quot;Material&quot;</span>);</div>
<div class="line">  outDiffuse =  addColorOutput(<span class="stringliteral">&quot;Diffuse&quot;</span>);</div>
<div class="line">  outSpecular = addColorOutput(<span class="stringliteral">&quot;Specular&quot;</span>);</div>
<div class="line">  outReflection = addColorOutput(<span class="stringliteral">&quot;Reflection&quot;</span>);</div>
<div class="line">  outRefraction = addColorOutput(<span class="stringliteral">&quot;Refraction&quot;</span>);</div>
<div class="line">  outTransparency = addScalarOutput(<span class="stringliteral">&quot;Transparency&quot;</span>);</div>
</div><!-- fragment --> Here we initialize our MaterialComponent classes - again, more on that later. <div class="fragment"><div class="line"></div>
<div class="line">  Diffuse.Initialize(*<span class="keyword">this</span>, <span class="stringliteral">&quot;Diffuse&quot;</span>);</div>
<div class="line">  Specular.Initialize(*<span class="keyword">this</span>, <span class="stringliteral">&quot;Specular&quot;</span>);</div>
<div class="line">  Reflection.Initialize(*<span class="keyword">this</span>, <span class="stringliteral">&quot;Reflection&quot;</span>);</div>
<div class="line">  Refraction.Initialize(*<span class="keyword">this</span>, <span class="stringliteral">&quot;Refraction&quot;</span>);</div>
<div class="line">  Transparency.Initialize(*<span class="keyword">this</span>, <span class="stringliteral">&quot;Transparency&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --> The Destructor does nothing in this case. <div class="fragment"><div class="line"></div>
<div class="line">MaterialMixer::~MaterialMixer ()</div>
<div class="line">{</div>
<div class="line">  ;</div>
<div class="line">}</div>
</div><!-- fragment --> Things are starting to heat up a little. lwpp uses operator=() to copy instances of the plugin. In this case you need to manually copy the MaterialComponent class. <div class="fragment"><div class="line"></div>
<div class="line">MaterialMixer &amp;MaterialMixer::operator=(<span class="keyword">const</span> MaterialMixer &amp;from)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (&amp;from != <span class="keyword">this</span>)</div>
<div class="line">  {</div>
<div class="line">    Diffuse = from.Diffuse;</div>
<div class="line">    Specular = from.Specular;</div>
<div class="line">    Reflection = from.Reflection;</div>
<div class="line">    Refraction = from.Refraction;</div>
<div class="line">    Transparency = from.Transparency;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> NewTime is called once per pass when rendering, or whenever the current frame changes. In this case the NewTime member function of the MaterialComponent member variables are called.</p>
<p>This is usually a good place to update <a class="el" href="classlwpp_1_1_v_parm.html" title="The Variant Parameter Class Wrapper.">lwpp::VParm</a> for example. <div class="fragment"><div class="line"></div>
<div class="line">LWError <a class="code" href="classlwpp_1_1_render_handler.html#a9e93b5a2d01ce9b917d956eba4b8aec0">MaterialMixer::NewTime</a> (LWFrame frame, LWTime time)</div>
<div class="line">{</div>
<div class="line">  Diffuse.NewTime(frame, time);</div>
<div class="line">  Specular.NewTime(frame, time);</div>
<div class="line">  Reflection.NewTime(frame, time);</div>
<div class="line">  Refraction.NewTime(frame, time);</div>
<div class="line">  Transparency.NewTime(frame, time);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> Evaluate is where the magic happens. In this case the current values of the inputs are retrieved and used for processing. setValue() (a member function of lwpp::Node, that <a class="el" href="classlwpp_1_1_node_handler.html">lwpp::NodeHandler</a> and thus <a class="el" href="classlwpp_1_1_x_panel_node_handler.html">lwpp::XPanelNodeHandler</a> derive from) is used to set the output value for the current output that is evaluated. <div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">void</span>  <a class="code" href="classlwpp_1_1_node_handler.html#ad8173b2e58fec04fb7650763e8eb4d48">MaterialMixer::Evaluate</a> (<a class="code" href="namespace_light_wave95.html#a5d7398223d10608d7239c03a96ddaac0">LWNodalAccess</a> *na, NodeOutputID outID, NodeValue value)</div>
<div class="line">{</div>
<div class="line">  LWNodalMaterial bgMat = {{0.0, 0.0, 0.0},{0.0, 0.0, 0.0},{0.0, 0.0, 0.0},{0.0, 0.0, 0.0},0};</div>
<div class="line">  LWNodalMaterial fgMat = {{0.0, 0.0, 0.0},{0.0, 0.0, 0.0},{0.0, 0.0, 0.0},{0.0, 0.0, 0.0},0};</div>
<div class="line">  LWNodalMaterial outMat= {{0.0, 0.0, 0.0},{0.0, 0.0, 0.0},{0.0, 0.0, 0.0},{0.0, 0.0, 0.0},0};</div>
<div class="line"></div>
<div class="line">  inBaseMaterial-&gt;evaluate(na, bgMat);</div>
<div class="line">  inTopMaterial-&gt;evaluate(na, fgMat);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (outMaterial-&gt;isID(outID))</div>
<div class="line">  {</div>
<div class="line">    inBaseDiffuse-&gt;evaluate(na, bgMat.diffuse);</div>
<div class="line">    inBaseSpecular-&gt;evaluate(na, bgMat.specular);</div>
<div class="line">    inBaseReflection-&gt;evaluate(na, bgMat.reflection);</div>
<div class="line">    inBaseRefraction-&gt;evaluate(na, bgMat.refraction);</div>
<div class="line">    inBaseTransparency-&gt;evaluate(na, bgMat.transparency);</div>
<div class="line"></div>
<div class="line">    inTopDiffuse-&gt;evaluate(na, fgMat.diffuse);</div>
<div class="line">    inTopSpecular-&gt;evaluate(na, fgMat.specular);</div>
<div class="line">    inTopReflection-&gt;evaluate(na, fgMat.reflection);</div>
<div class="line">    inTopRefraction-&gt;evaluate(na, fgMat.refraction);</div>
<div class="line">    inTopTransparency-&gt;evaluate(na, fgMat.transparency);</div>
<div class="line"></div>
<div class="line">    Diffuse.evaluate(na, bgMat.diffuse, fgMat.diffuse, outMat.diffuse);</div>
<div class="line">    Specular.evaluate(na, bgMat.specular, fgMat.specular, outMat.specular);</div>
<div class="line">    Reflection.evaluate(na, bgMat.reflection, fgMat.reflection, outMat.reflection);</div>
<div class="line">    Refraction.evaluate(na, bgMat.refraction, fgMat.refraction, outMat.refraction);</div>
<div class="line">    Transparency.evaluate(na, bgMat.transparency, fgMat.transparency, outMat.transparency);</div>
<div class="line"></div>
<div class="line">    setValue(value, outMat);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (outDiffuse-&gt;isID(outID))</div>
<div class="line">  {</div>
<div class="line">    inBaseDiffuse-&gt;evaluate(na, bgMat.diffuse);</div>
<div class="line">    inTopDiffuse-&gt;evaluate(na, fgMat.diffuse);</div>
<div class="line">    Diffuse.evaluate(na, bgMat.diffuse, fgMat.diffuse, outMat.diffuse);</div>
<div class="line">    setValue(value, outMat.diffuse);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (outSpecular-&gt;isID(outID))</div>
<div class="line">  {</div>
<div class="line">    inBaseSpecular-&gt;evaluate(na, bgMat.specular);</div>
<div class="line">    inTopSpecular-&gt;evaluate(na, fgMat.specular);</div>
<div class="line">    Specular.evaluate(na, bgMat.specular, fgMat.specular, outMat.specular);</div>
<div class="line">    setValue(value, outMat.specular);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (outReflection-&gt;isID(outID))</div>
<div class="line">  {</div>
<div class="line">    inBaseReflection-&gt;evaluate(na, bgMat.reflection);</div>
<div class="line">    inTopReflection-&gt;evaluate(na, fgMat.reflection);</div>
<div class="line">    Reflection.evaluate(na, bgMat.reflection, fgMat.reflection, outMat.reflection);</div>
<div class="line">    setValue(value, outMat.reflection);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (outRefraction-&gt;isID(outID))</div>
<div class="line">  {</div>
<div class="line">    inBaseRefraction-&gt;evaluate(na, bgMat.refraction);</div>
<div class="line">    inTopRefraction-&gt;evaluate(na, fgMat.refraction);</div>
<div class="line">    Refraction.evaluate(na, bgMat.refraction, fgMat.refraction, outMat.refraction);</div>
<div class="line">    setValue(value, outMat.refraction);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (outTransparency-&gt;isID(outID))</div>
<div class="line">  {</div>
<div class="line">    inBaseTransparency-&gt;evaluate(na, bgMat.transparency);</div>
<div class="line">    inTopTransparency-&gt;evaluate(na, fgMat.transparency);</div>
<div class="line">    Transparency.evaluate(na, bgMat.transparency, fgMat.transparency, outMat.transparency);</div>
<div class="line">    setValue(value, outMat.transparency);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> Next we'll define an enum for the IDs of the XPanel controls as well as a static array of strings for the pop-up defining the blend mode. <div class="fragment"><div class="line"></div>
<div class="line"><span class="keyword">enum</span> { <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a53019db4a82cf7bb6f7870d7d06f9f1d">BDiff</a> = 0x9000, <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a46c09647f4ea30cf4c4f609388b0f3ef">MDiff</a>, <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a938139d68f33a06187e5f02cfb1c79c8">BSpec</a>, <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a4310f4961861b486cedc9be59467f722">MSpec</a>, <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5fbb19ff2d4f2bb05dfcddfc072b9d5e">BRefl</a>, <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a2f21b7113bcf01ae06c951d6c5aa8d94">MRefl</a>, <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a8825b1a8378fc631c0dc8ab6afd147b6">BRefr</a>, <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57ac1484a853c5d095352a60f4504516928">MRefr</a>, <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a0a7370921d63d5ebf80d435526aca111">BTran</a>, <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57aaf31311102a7d89548af06b0bf1b2b8d">MTran</a>};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *blendModeS[] =</div>
<div class="line">{</div>
<div class="line">  <span class="stringliteral">&quot;Normal&quot;</span>, <span class="stringliteral">&quot;Additive&quot;</span>, <span class="stringliteral">&quot;Subtractive&quot;</span>, <span class="stringliteral">&quot;Multiply&quot;</span>, <span class="stringliteral">&quot;Screen&quot;</span>, <span class="stringliteral">&quot;Darken&quot;</span>, <span class="stringliteral">&quot;Lighten&quot;</span>, <span class="stringliteral">&quot;Difference&quot;</span>, <span class="stringliteral">&quot;Negative&quot;</span>, <span class="stringliteral">&quot;Colour Dodge&quot;</span>, <span class="stringliteral">&quot;Colour Burn&quot;</span>, <span class="stringliteral">&quot;Red&quot;</span>, <span class="stringliteral">&quot;Green&quot;</span>, <span class="stringliteral">&quot;Blue&quot;</span>,  0</div>
<div class="line">};</div>
</div><!-- fragment --> </p>
<h1><a class="anchor" id="GUI"></a>
Creating an XPanels GUI</h1>
<p>Now we're ready to construct our interface, this is done by overriding the Interface() method of the base plugin: <div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="classlwpp_1_1_x_panel_interface.html#a30270b56c812a1a3b12a5e70eab2213e">MaterialMixer::Interface</a> (<span class="keywordtype">int</span> version, LWInterface *local, <span class="keywordtype">void</span> *serverdata)</div>
</div><!-- fragment --> Now we define the LWXPanelControl and LWXPanelDataDesc arrays for XPanel as well as our hints for the GUI. This is identical to using the C SDK for XPanels. <div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keyword">static</span> LWXPanelControl ctrl[] =</div>
<div class="line">  {</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a46c09647f4ea30cf4c4f609388b0f3ef">MDiff</a>, <span class="stringliteral">&quot;Diffuse Mode&quot;</span>, <span class="stringliteral">&quot;iPopChoice&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a53019db4a82cf7bb6f7870d7d06f9f1d">BDiff</a>, <span class="stringliteral">&quot;Diffuse Opacity&quot;</span>, <span class="stringliteral">&quot;percent-env&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a4310f4961861b486cedc9be59467f722">MSpec</a>, <span class="stringliteral">&quot;Specular Mode&quot;</span>, <span class="stringliteral">&quot;iPopChoice&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a938139d68f33a06187e5f02cfb1c79c8">BSpec</a>, <span class="stringliteral">&quot;Specular Opacity&quot;</span>, <span class="stringliteral">&quot;percent-env&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a2f21b7113bcf01ae06c951d6c5aa8d94">MRefl</a>, <span class="stringliteral">&quot;Reflection Mode&quot;</span>, <span class="stringliteral">&quot;iPopChoice&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5fbb19ff2d4f2bb05dfcddfc072b9d5e">BRefl</a>, <span class="stringliteral">&quot;Reflection Opacity&quot;</span>, <span class="stringliteral">&quot;percent-env&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57ac1484a853c5d095352a60f4504516928">MRefr</a>, <span class="stringliteral">&quot;Refraction Mode&quot;</span>, <span class="stringliteral">&quot;iPopChoice&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a8825b1a8378fc631c0dc8ab6afd147b6">BRefr</a>, <span class="stringliteral">&quot;Refraction Opacity&quot;</span>, <span class="stringliteral">&quot;percent-env&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57aaf31311102a7d89548af06b0bf1b2b8d">MTran</a>, <span class="stringliteral">&quot;Transparency Mode&quot;</span>, <span class="stringliteral">&quot;iPopChoice&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a0a7370921d63d5ebf80d435526aca111">BTran</a>, <span class="stringliteral">&quot;Transparency Opacity&quot;</span>, <span class="stringliteral">&quot;percent-env&quot;</span>},</div>
<div class="line">    0</div>
<div class="line">  };</div>
<div class="line">  <span class="keyword">static</span> LWXPanelDataDesc desc[] =</div>
<div class="line">  {</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a46c09647f4ea30cf4c4f609388b0f3ef">MDiff</a>, <span class="stringliteral">&quot;Diffuse Mode&quot;</span>, <span class="stringliteral">&quot;integer&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a53019db4a82cf7bb6f7870d7d06f9f1d">BDiff</a>, <span class="stringliteral">&quot;Diffuse Opacity&quot;</span>, <span class="stringliteral">&quot;float-env&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a4310f4961861b486cedc9be59467f722">MSpec</a>, <span class="stringliteral">&quot;Specular Mode&quot;</span>, <span class="stringliteral">&quot;integer&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a938139d68f33a06187e5f02cfb1c79c8">BSpec</a>, <span class="stringliteral">&quot;Specular Opacity&quot;</span>, <span class="stringliteral">&quot;float-env&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a2f21b7113bcf01ae06c951d6c5aa8d94">MRefl</a>, <span class="stringliteral">&quot;Reflection Mode&quot;</span>, <span class="stringliteral">&quot;integer&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5fbb19ff2d4f2bb05dfcddfc072b9d5e">BRefl</a>, <span class="stringliteral">&quot;Reflection Opacity&quot;</span>, <span class="stringliteral">&quot;float-env&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57ac1484a853c5d095352a60f4504516928">MRefr</a>, <span class="stringliteral">&quot;Refraction Mode&quot;</span>, <span class="stringliteral">&quot;integer&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a8825b1a8378fc631c0dc8ab6afd147b6">BRefr</a>, <span class="stringliteral">&quot;Refraction Opacity&quot;</span>, <span class="stringliteral">&quot;float-env&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57aaf31311102a7d89548af06b0bf1b2b8d">MTran</a>, <span class="stringliteral">&quot;Transparency Mode&quot;</span>, <span class="stringliteral">&quot;integer&quot;</span>},</div>
<div class="line">    {<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a0a7370921d63d5ebf80d435526aca111">BTran</a>, <span class="stringliteral">&quot;Transparency Opacity&quot;</span>, <span class="stringliteral">&quot;float-env&quot;</span>},</div>
<div class="line">  };</div>
<div class="line"></div>
<div class="line">  <span class="keyword">static</span> LWXPanelHint hints[] =</div>
<div class="line">  {</div>
<div class="line">    XpSTRLIST(<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a46c09647f4ea30cf4c4f609388b0f3ef">MDiff</a>, blendModeS),</div>
<div class="line">    XpSTRLIST(<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a4310f4961861b486cedc9be59467f722">MSpec</a>, blendModeS),</div>
<div class="line">    XpSTRLIST(<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a2f21b7113bcf01ae06c951d6c5aa8d94">MRefl</a>, blendModeS),</div>
<div class="line">    XpSTRLIST(<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57ac1484a853c5d095352a60f4504516928">MRefr</a>, blendModeS),</div>
<div class="line">    XpSTRLIST(<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57aaf31311102a7d89548af06b0bf1b2b8d">MTran</a>, blendModeS),</div>
<div class="line">    XpDIVADD(<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a53019db4a82cf7bb6f7870d7d06f9f1d">BDiff</a>),</div>
<div class="line">    XpDIVADD(<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a938139d68f33a06187e5f02cfb1c79c8">BSpec</a>),</div>
<div class="line">    XpDIVADD(<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5fbb19ff2d4f2bb05dfcddfc072b9d5e">BRefl</a>),</div>
<div class="line">    XpDIVADD(<a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a8825b1a8378fc631c0dc8ab6afd147b6">BRefr</a>),</div>
<div class="line">    XpEND,</div>
<div class="line">  };</div>
</div><!-- fragment --> CreateViewXPanel() creates the panel and the ID is returned to LW so it can handle it if needed. <div class="fragment"><div class="line"></div>
<div class="line">  CreateViewXPanel (ctrl, desc, hints);</div>
<div class="line">  local-&gt;panel = LW_XPanel.getID();</div>
<div class="line">  <span class="keywordflow">return</span> AFUNC_OK;</div>
<div class="line">}</div>
</div><!-- fragment --> Now that we have created the XPanel GUI we need to manage the change of user interface controls. Again, this is done by overriding member functions of the base class.</p>
<p>DataGet() returns the value of a control to LW to display: <div class="fragment"><div class="line"></div>
<div class="line"><span class="keywordtype">void</span> *<a class="code" href="classlwpp_1_1_x_panel_interface.html#af1a99e652b66ebc82619e8cfc5039c7f" title="Put data into a XPanel View.">MaterialMixer::DataGet</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vid)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span> (vid)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a46c09647f4ea30cf4c4f609388b0f3ef">MDiff</a>: <span class="keywordflow">return</span> Diffuse.ModeGet(); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a4310f4961861b486cedc9be59467f722">MSpec</a>: <span class="keywordflow">return</span> Specular.ModeGet(); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a2f21b7113bcf01ae06c951d6c5aa8d94">MRefl</a>: <span class="keywordflow">return</span> Reflection.ModeGet(); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57ac1484a853c5d095352a60f4504516928">MRefr</a>: <span class="keywordflow">return</span> Refraction.ModeGet(); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57aaf31311102a7d89548af06b0bf1b2b8d">MTran</a>: <span class="keywordflow">return</span> Transparency.ModeGet(); <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a53019db4a82cf7bb6f7870d7d06f9f1d">BDiff</a>: <span class="keywordflow">return</span> Diffuse.OpacityGet();  <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a938139d68f33a06187e5f02cfb1c79c8">BSpec</a>: <span class="keywordflow">return</span> Specular.OpacityGet(); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a5fbb19ff2d4f2bb05dfcddfc072b9d5e">BRefl</a>: <span class="keywordflow">return</span> Reflection.OpacityGet(); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a8825b1a8378fc631c0dc8ab6afd147b6">BRefr</a>: <span class="keywordflow">return</span> Refraction.OpacityGet(); <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a0a7370921d63d5ebf80d435526aca111">BTran</a>: <span class="keywordflow">return</span> Transparency.OpacityGet(); <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> DataSet() is LightWave telling the plugin that the value of a control changed. We store the changed value in our member variables. <div class="fragment"><div class="line"></div>
<div class="line">LWXPRefreshCode <a class="code" href="classlwpp_1_1_x_panel_interface.html#a3367d544fda0defa57d36ffe33aedff3" title="Retrieve data fom a XPanel View.">MaterialMixer::DataSet</a> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vid, <span class="keywordtype">void</span> *value)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> *i = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span> *<span class="keyword">&gt;</span>(value);</div>
<div class="line">  <span class="keywordflow">switch</span> (vid)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a46c09647f4ea30cf4c4f609388b0f3ef">MDiff</a>: Diffuse.Mode = (BlendingMode)*i; <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a4310f4961861b486cedc9be59467f722">MSpec</a>: Specular.Mode = (BlendingMode)*i; <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57a2f21b7113bcf01ae06c951d6c5aa8d94">MRefl</a>: Reflection.Mode = (BlendingMode)*i; <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57ac1484a853c5d095352a60f4504516928">MRefr</a>: Refraction.Mode = (BlendingMode)*i; <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#ab04a0655cd1e3bcac5e8f48c18df1a57aaf31311102a7d89548af06b0bf1b2b8d">MTran</a>: Transparency.Mode = (BlendingMode)*i; <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> LWXPRC_DFLT;</div>
<div class="line">}</div>
</div><!-- fragment --> ChangeNotify() again is a member function override. It is set up automatically by lwpp.</p>
<p>In this case we update the node preview (yet another member function provided by lwpp for Nodes) if a value has changed while the user is changing a control. Once the user releases the control, we perform a full Update() (as you guessed, yet another member function provided by lwpp). <div class="fragment"><div class="line"></div>
<div class="line"> <span class="keywordtype">void</span> <a class="code" href="classlwpp_1_1_x_panel_node_handler.html#a7a9dbd139fcd475b917928cd8da133d4">MaterialMixer::ChangeNotify</a> (LWXPanelID panel, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cid, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vid, <span class="keywordtype">int</span> event_type)</div>
<div class="line"> {</div>
<div class="line">    <span class="keywordflow">if</span> (event_type == LWXPEVENT_TRACK)</div>
<div class="line">    {</div>
<div class="line">      UpdateNodePreview();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event_type == LWXPEVENT_VALUE)</div>
<div class="line">    {</div>
<div class="line">      Update();</div>
<div class="line">    }</div>
<div class="line"> }</div>
</div><!-- fragment --> This concludes the GUI code and we can proceed with loading and saving our variables. </p>
<h1><a class="anchor" id="IO"></a>
Loading and saving settings</h1>
<p>We start off by defining LWIDs and a LWBlockIdent struct for the LightWave i/o system. <div class="fragment"><div class="line"></div>
<div class="line"><span class="comment">// defines etc. for file i/o</span></div>
<div class="line"><span class="preprocessor">#define IO_CDIF LWID_(&#39;C&#39;,&#39;D&#39;,&#39;I&#39;,&#39;F&#39;)  </span></div>
<div class="line"><span class="preprocessor">#define IO_CSPC LWID_(&#39;C&#39;,&#39;S&#39;,&#39;P&#39;,&#39;C&#39;)  </span></div>
<div class="line"><span class="preprocessor">#define IO_CRFL LWID_(&#39;C&#39;,&#39;R&#39;,&#39;F&#39;,&#39;L&#39;)  </span></div>
<div class="line"><span class="preprocessor">#define IO_CRFR LWID_(&#39;C&#39;,&#39;R&#39;,&#39;F&#39;,&#39;R&#39;)  </span></div>
<div class="line"><span class="preprocessor">#define IO_CTRN LWID_(&#39;C&#39;,&#39;T&#39;,&#39;R&#39;,&#39;N&#39;)  </span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="keyword">static</span> LWBlockIdent idroot[] =</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="_material_blender_8cpp.html#a00f1b8ace3a322987f770d08e73b2b9d">IO_CDIF</a>, <span class="stringliteral">&quot;Diffuse&quot;</span>, <span class="comment">// 0</span></div>
<div class="line">  <a class="code" href="_material_blender_8cpp.html#aecab7ed84154123ac2d46eabab690393">IO_CSPC</a>, <span class="stringliteral">&quot;Specular&quot;</span>, <span class="comment">// 1</span></div>
<div class="line">  <a class="code" href="_material_blender_8cpp.html#a9f3af038b9a1dd7d44c204f4931824d6">IO_CRFL</a>, <span class="stringliteral">&quot;Reflection&quot;</span>, <span class="comment">// 2</span></div>
<div class="line">  <a class="code" href="_material_blender_8cpp.html#a08b66cfda886d6404e001b4b091e7f83">IO_CRFR</a>, <span class="stringliteral">&quot;Refrection&quot;</span>, <span class="comment">// 3</span></div>
<div class="line">  <a class="code" href="_material_blender_8cpp.html#afe3a8b7f7386b32d844226d648ca038c">IO_CTRN</a>, <span class="stringliteral">&quot;Transparency&quot;</span>, <span class="comment">// 4</span></div>
<div class="line">  0</div>
<div class="line">};</div>
</div><!-- fragment --> Loading is quite similar to using LWs native system. We advise to use nested blocks. All classes derived from <a class="el" href="classlwpp_1_1_storeable.html">lwpp::Storeable</a> can be passed directly to a <a class="el" href="classlwpp_1_1_load_state.html" title="Wrapper for a LW save state.">lwpp::LoadState</a> or <a class="el" href="classlwpp_1_1_save_state.html" title="Wrapper for a LW save state.">lwpp::SaveState</a> for i/o. <div class="fragment"><div class="line"></div>
<div class="line">LWError <a class="code" href="classlwpp_1_1_storeable.html#a0580c9da89100c44170c447f00f8a251" title="Load data from a LWLoadState.">MaterialMixer::Load</a> (<span class="keyword">const</span> <a class="code" href="classlwpp_1_1_load_state.html" title="Wrapper for a LW save state.">lwpp::LoadState</a> &amp;ls)</div>
<div class="line">{</div>
<div class="line">  LWError err = 0;</div>
<div class="line">  <span class="keywordflow">while</span>(LWID <span class="keywordtype">id</span> = ls.<a class="code" href="classlwpp_1_1_load_state.html#aae65912f20d97bb72a9303cffaba1f8a">Find</a>(idroot))</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">switch</span>( <span class="keywordtype">id</span> )</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#a00f1b8ace3a322987f770d08e73b2b9d">IO_CDIF</a>: ls.<a class="code" href="classlwpp_1_1_load_state.html#a97a14ff968d6874abcfd2ca84e3eeb5f">read</a>(Diffuse); <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#aecab7ed84154123ac2d46eabab690393">IO_CSPC</a>: ls.<a class="code" href="classlwpp_1_1_load_state.html#a97a14ff968d6874abcfd2ca84e3eeb5f">read</a>(Specular); <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#a9f3af038b9a1dd7d44c204f4931824d6">IO_CRFL</a>: ls.<a class="code" href="classlwpp_1_1_load_state.html#a97a14ff968d6874abcfd2ca84e3eeb5f">read</a>(Reflection); <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#a08b66cfda886d6404e001b4b091e7f83">IO_CRFR</a>: ls.<a class="code" href="classlwpp_1_1_load_state.html#a97a14ff968d6874abcfd2ca84e3eeb5f">read</a>(Refraction); <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#afe3a8b7f7386b32d844226d648ca038c">IO_CTRN</a>: ls.<a class="code" href="classlwpp_1_1_load_state.html#a97a14ff968d6874abcfd2ca84e3eeb5f">read</a>(Transparency); <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    ls.<a class="code" href="classlwpp_1_1_load_state.html#a5e05c38c49d32c9a4120fec6017c60e6">End</a>();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
</div><!-- fragment --> Saving is even easier, especially since the MaterialComponent class used in this sample is derived from <a class="el" href="classlwpp_1_1_storeable.html">lwpp::Storeable</a> <div class="fragment"><div class="line">LWError <a class="code" href="classlwpp_1_1_storeable.html#a94013c12ec3483db0ef74b1b7a5de0b2" title="Save data to a LWSaveState.">MaterialMixer::Save</a> (<span class="keyword">const</span> <a class="code" href="classlwpp_1_1_save_state.html" title="Wrapper for a LW save state.">lwpp::SaveState</a> &amp;ss)</div>
<div class="line">{</div>
<div class="line">  LWError err = 0;</div>
<div class="line">  ss.<a class="code" href="classlwpp_1_1_save_state.html#a9d6f6b8089d5da33ce7231ca44b7a7f1">WriteItem</a>(idroot[0], Diffuse);</div>
<div class="line">  ss.<a class="code" href="classlwpp_1_1_save_state.html#a9d6f6b8089d5da33ce7231ca44b7a7f1">WriteItem</a>(idroot[1], Specular);</div>
<div class="line">  ss.<a class="code" href="classlwpp_1_1_save_state.html#a9d6f6b8089d5da33ce7231ca44b7a7f1">WriteItem</a>(idroot[2], Reflection);</div>
<div class="line">  ss.<a class="code" href="classlwpp_1_1_save_state.html#a9d6f6b8089d5da33ce7231ca44b7a7f1">WriteItem</a>(idroot[3], Refraction);</div>
<div class="line">  ss.<a class="code" href="classlwpp_1_1_save_state.html#a9d6f6b8089d5da33ce7231ca44b7a7f1">WriteItem</a>(idroot[4], Transparency);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </p>
<h1><a class="anchor" id="Additional"></a>
The MaterialComponent class</h1>
<p>This class is a helper class to manage the components used in the material blender and to reduce the amount of duplicate code:  <div class="fragment"><div class="line"><span class="preprocessor">#define IO_MODE LWID_(&#39;M&#39;,&#39;O&#39;,&#39;D&#39;,&#39;E&#39;)  </span></div>
<div class="line"><span class="preprocessor">#define IO_OPAC LWID_(&#39;O&#39;,&#39;P&#39;,&#39;A&#39;,&#39;C&#39;)  </span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="keyword">static</span> LWBlockIdent idcomp[] =</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="_material_blender_8cpp.html#af7730959952a50b7f2fc7e10457565a1">IO_MODE</a>, <span class="stringliteral">&quot;Mode&quot;</span>, <span class="comment">// 0</span></div>
<div class="line">  <a class="code" href="_material_blender_8cpp.html#a064d381e818eaf7de26b545f8fbd304d">IO_OPAC</a>, <span class="stringliteral">&quot;Opacity&quot;</span>, <span class="comment">// 1</span></div>
<div class="line">  0</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>MaterialComponent : <span class="keyword">public</span> <a class="code" href="classlwpp_1_1_storeable.html">lwpp::Storeable</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a class="code" href="classlwpp_1_1_l_w_node_input.html" title="Node Input.">lwpp::LWNodeInput</a> *inMode;</div>
<div class="line">  <a class="code" href="classlwpp_1_1_l_w_node_input.html" title="Node Input.">lwpp::LWNodeInput</a> *inOpacity;</div>
<div class="line">  <a class="code" href="classlwpp_1_1_l_w_node_utility.html">lwpp::LWNodeUtility</a> nodeUtil;</div>
<div class="line">  <a class="code" href="classlwpp_1_1_v_parm.html" title="The Variant Parameter Class Wrapper.">lwpp::VParm</a> *Opacity;</div>
<div class="line">  BlendingMode Mode;</div>
<div class="line">  MaterialComponent()</div>
<div class="line">    : Mode(Blend_Normal),</div>
<div class="line">      inMode(0), inOpacity(0),</div>
<div class="line">      Opacity(0)</div>
<div class="line">  {</div>
<div class="line">    ;</div>
<div class="line">  }</div>
<div class="line">  MaterialComponent &amp;operator=(<span class="keyword">const</span> MaterialComponent &amp;from)</div>
<div class="line">  {</div>
<div class="line">    *Opacity = *from.Opacity;</div>
<div class="line">    Mode = from.Mode;</div>
<div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> Initialize(<a class="code" href="classlwpp_1_1_node_handler.html">lwpp::NodeHandler</a> &amp;node, std::string name)</div>
<div class="line">  {</div>
<div class="line">    inOpacity = node.<a class="code" href="classlwpp_1_1_node_handler.html#a537e745bd70ad8994474081ea2b2cb7d">addScalarInput</a>(name + <span class="stringliteral">&quot; Opacity&quot;</span>);</div>
<div class="line">    inMode = node.<a class="code" href="classlwpp_1_1_node_handler.html#a2bb04cb009ce293d452e7b20509d6d4e">addIntegerInput</a>(name + <span class="stringliteral">&quot; Mode&quot;</span>);</div>
<div class="line">    Opacity = <span class="keyword">new</span> <a class="code" href="classlwpp_1_1_v_parm.html" title="The Variant Parameter Class Wrapper.">lwpp::VParm</a>(LWVP_PERCENT , name+<span class="stringliteral">&quot;Opacity&quot;</span>, <a class="code" href="_material_blender_8cpp.html#aa407a87106856e695db211c63ff71fe6">pluginName</a>, node.<a class="code" href="classlwpp_1_1_l_w_node.html#a75aa3d9b7e6b28f0506bf3ecf025966f">chanGrp</a>());</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> evaluate(<a class="code" href="namespace_light_wave95.html#a5d7398223d10608d7239c03a96ddaac0">LWNodalAccess</a> *na, LWDVector bg, LWDVector fg, LWDVector &amp;out)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">double</span> opacity = Opacity-&gt;<a class="code" href="classlwpp_1_1_v_parm.html#abff994da8cb1fe609fdb0731aeb1df3f">GetValue</a>();</div>
<div class="line">    inOpacity-&gt;evaluate(na, opacity);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> mode = (int)Mode;</div>
<div class="line"></div>
<div class="line">    inMode-&gt;evaluate(na, mode);</div>
<div class="line">    nodeUtil.Blend(out, bg, fg, opacity, (BlendingMode)<a class="code" href="namespacelwpp.html#ab6d1ec6b1614175cfdbdda42b43338bc" title="Clamp a value between min and max.">lwpp::Clamp</a>(mode, 0, 13));</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> evaluate(<a class="code" href="namespace_light_wave95.html#a5d7398223d10608d7239c03a96ddaac0">LWNodalAccess</a> *na, <span class="keywordtype">double</span> bg, <span class="keywordtype">double</span> fg, <span class="keywordtype">double</span> &amp;out)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">double</span> opacity = Opacity-&gt;GetValue();</div>
<div class="line">    inOpacity-&gt;evaluate(na, opacity);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> mode = (int)Mode;</div>
<div class="line">    inMode-&gt;evaluate(na, mode);</div>
<div class="line"></div>
<div class="line">    LWDVector f = {fg, 0.0, 0.0};</div>
<div class="line">    LWDVector b = {bg, 0.0, 0.0};</div>
<div class="line">    LWDVector o = {out, 0.0, 0.0};</div>
<div class="line"></div>
<div class="line">    nodeUtil.Blend(o, b, f, opacity, (BlendingMode)<a class="code" href="namespacelwpp.html#ab6d1ec6b1614175cfdbdda42b43338bc" title="Clamp a value between min and max.">lwpp::Clamp</a>(mode, 0, 13));</div>
<div class="line">    out = o[0];</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> *ModeGet ()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (!inMode-&gt;isConnected()) <span class="keywordflow">return</span> &amp;Mode;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> *OpacityGet ()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (!inOpacity-&gt;isConnected()) <span class="keywordflow">return</span> Opacity-&gt;ID();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  LWError NewTime (LWFrame frame, LWTime time)</div>
<div class="line">  {</div>
<div class="line">    Opacity-&gt;NewTime(time);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">virtual</span> LWError <a class="code" href="classlwpp_1_1_storeable.html#a0580c9da89100c44170c447f00f8a251" title="Load data from a LWLoadState.">Load</a> (<span class="keyword">const</span> <a class="code" href="classlwpp_1_1_load_state.html" title="Wrapper for a LW save state.">lwpp::LoadState</a> &amp;ls)</div>
<div class="line">  {</div>
<div class="line">    LWError err = 0;</div>
<div class="line">    <span class="keywordflow">while</span>(LWID <span class="keywordtype">id</span> = ls.<a class="code" href="classlwpp_1_1_load_state.html#aae65912f20d97bb72a9303cffaba1f8a">Find</a>(idcomp))</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">switch</span>( <span class="keywordtype">id</span> )</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#af7730959952a50b7f2fc7e10457565a1">IO_MODE</a>: Mode = (BlendingMode)ls.<a class="code" href="classlwpp_1_1_load_state.html#a1ac6ba571529c5458ddd50b168a7d6dc">readInt</a>(); <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="_material_blender_8cpp.html#a064d381e818eaf7de26b545f8fbd304d">IO_OPAC</a>: ls.<a class="code" href="classlwpp_1_1_load_state.html#a97a14ff968d6874abcfd2ca84e3eeb5f">read</a>(*Opacity); <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      ls.<a class="code" href="classlwpp_1_1_load_state.html#a5e05c38c49d32c9a4120fec6017c60e6">End</a>();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">virtual</span> LWError <a class="code" href="classlwpp_1_1_storeable.html#a94013c12ec3483db0ef74b1b7a5de0b2" title="Save data to a LWSaveState.">Save</a> (<span class="keyword">const</span> <a class="code" href="classlwpp_1_1_save_state.html" title="Wrapper for a LW save state.">lwpp::SaveState</a> &amp;ss)</div>
<div class="line">  {</div>
<div class="line">    LWError err = 0;</div>
<div class="line">    ss.<a class="code" href="classlwpp_1_1_save_state.html#a7eb472b7a24859cd5671d3c594f4db57" title="Save a value embedded in a block.">WriteBlock</a>(idcomp[0], (<span class="keywordtype">int</span>)Mode);</div>
<div class="line">    ss.<a class="code" href="classlwpp_1_1_save_state.html#a9d6f6b8089d5da33ce7231ca44b7a7f1">WriteItem</a>(idcomp[1], *Opacity);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">LightWrap++, a C++ SDK wrapper for LightWave3D</a></li>
    <li class="footer">Generated on Wed Sep 19 2012 18:30:23 for LightWrap++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.1 </li>
  </ul>
</div>
</body>
</html>
